DROP TABLE IF EXISTS `reports`;
CREATE TABLE `reports` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(255) COLLATE utf8mb4_general_ci NOT NULL,
  `sql` text COLLATE utf8mb4_general_ci NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

INSERT INTO `reports` (`id`, `name`, `sql`) VALUES
(1,	'atm_csv',	'SELECT \r\n      Subscriptions.id, subscription, user_id, company_id, status_id, note, created, modified,        \r\n      Companies.name as nome_azienda, \r\n      Companies.company_code as codice_azienda,\r\n      subscription->\"$.mese_validita\" as mese_validita,\r\n      subscription->\"$.origine\" as origine,\r\n      subscription->\"$.destinazione\" as destinazione,\r\n      subscription->\"$.abbonamento_selezionato\" as abbonamento_selezionato,\r\n      subscription->\"$.nome\" as nome,\r\n      subscription->\"$.cognome\" as cognome,\r\n      subscription->\"$.codice_fiscale\" as codice_fiscale,\r\n      subscription->\"$.cittadinanza\" as cittadinanza,\r\n      subscription->\"$.comune_nascita\" as comune_nascita,\r\n      subscription->\"$.provincia_nascita\" as provincia_nascita,\r\n      subscription->\"$.documento_ID\" as documento_ID,\r\n      subscription->\"$.nr_documento_ID\" as nr_documento_ID,\r\n      subscription->\"$.residenza\" as residenza,\r\n      subscription->\"$.email\" as email,\r\n      subscription->\"$.telefono\" as telefono,\r\n      subscription->\"$.matricola\" as matricola,\r\n      subscription->\"$.tessera_tpl\" as tessera_tpl,\r\n      subscription->\"$.operatore\" as operatore,\r\n      subscription->\"$.prezzo_pieno\" as prezzo_pieno,\r\n      subscription->\"$.prezzo_scontato\" as prezzo_scontato,\r\n      subscription->\"$.sesso\" as sesso,\r\n      subscription->\"$.cap_residenza\" as cap_residenza,\r\n      subscription->\"$.comune_residenza\" as comune_residenza,\r\n      subscription->\"$.provincia_residenza\" as provincia_residenza,\r\n      subscription->\"$.data_nascita\" as data_nascita\r\n    FROM \r\n      subscriptions Subscriptions \r\n      left join companies Companies on (Subscriptions.company_id = Companies.id)\r\n    WHERE \r\n      Subscriptions.status_id =1'),
(2,	'atm_dettaglio_ordini',	'SELECT\r\n	DATE_FORMAT(subscription->>\'$.mese_validita\',\'%Y%m\') as DECORRENZA,\r\n	#//non esiste, probabilmente si tratta del codice di Jointly per ATM, il campo deve essere intitolato \"CODICE AZIENDA MASTER\"\r\n	9999 as `CODICE_AZIENDA_MASTER`,    \r\n	#//non esiste, si tratta del codice dell\'azienda destinatario abbonamenti - il campo dev\'essere intitolato \"CODICE_CLIENTE_DESTINATARIO\"\r\n	Companies.company_code as CODICE_CLIENTE_DESTINATARIO, \r\n    Companies.name as `RAGIONE SOCIALE`,\r\n    CONCAT(subscription->>\"$.cognome\",\" \" , subscription->>\"$.nome\") NOMINATIVO,\r\n    subscription->>\"$.codice_fiscale\" as codice_fiscale,\r\n    subscription->>\"$.abbonamento_selezionato\" as ABBONAMENTO,\r\n    ##Attenzione non c\'è a DB non esiste , dev\'essere intitolato \"CAMBIO AREA\" e dev\'essere compilato con una \"N\" o \"S\"\r\n    \'N\' AS `CAMBIO AREA`, \r\n    ##0= Nuovo, 1= Rinnovo, dev\'essere intitolato \"RINNOVO\" e dev\'essere compilato con una \"N\" o \"S\" - USARE CASE\r\n    subscription->>\"$.tessera_tpl\" as RINNOVO,\r\n    ##non so se deve già prevedere lo sconto del 5% cheda ATM\r\n    subscription->>\"$.prezzo_pieno\" as `COSTO ABBONAMENTO`,\r\n    ##non esiste, e non capisco la differenza con il \"prezzo_pieno\", nell\'esempio sembra uguale\r\n    subscription->>\"$.prezzo_pieno\" as costo_totale   \r\n  FROM \r\n    subscriptions Subscriptions \r\n    left join companies Companies on (Subscriptions.company_id = Companies.id)\r\n  WHERE\r\n  Subscriptions.status_id =1\r\n  AND (Subscriptions.company_id = :cid OR :cid is NULL )\r\n  AND (:op is NULL OR JSON_EXTRACT(subscription, \'$.operatore\') = :op   )  \r\n    '),
(3,	'atm_riepilogo_ordini',	'SELECT\r\n	DATE_FORMAT(subscription->>\'$.mese_validita\',\'%Y%m\') as DECORRENZA,\r\n	#//non esiste, probabilmente si tratta del codice di Jointly per ATM, il campo deve essere intitolato \"CODICE AZIENDA MASTER\"\r\n	9999 as `CODICE_AZIENDA_MASTER`,    \r\n	#//non esiste, si tratta del codice dell\'azienda destinatario abbonamenti - il campo dev\'essere intitolato \"CODICE_CLIENTE_DESTINATARIO\"\r\n	Companies.company_code as CODICE_CLIENTE_DESTINATARIO, \r\n    Companies.name as `RAGIONE SOCIALE`,\r\n    subscription->>\"$.abbonamento_selezionato\" as ABBONAMENTO,\r\n    sum(subscription->>\"$.tessera_tpl\"=1) as  NUMERO_ABBONAMENTI_NUOVI,\r\n    count(subscription->>\"$.abbonamento_selezionato\") as NUMERO_ABBONAMENTI,\r\n    subscription->>\"$.prezzo_pieno\" as `COSTO_TOTALE`\r\n  FROM \r\n    subscriptions Subscriptions \r\n    left join companies Companies on (Subscriptions.company_id = Companies.id)\r\n  WHERE\r\n  Subscriptions.status_id =1\r\n  AND (Subscriptions.company_id = :cid OR :cid is NULL )\r\n  AND (:op is NULL OR JSON_EXTRACT(subscription, \'$.operatore\') = :op   )\r\n  GROUP BY \r\n  	company_id,\r\n  	subscription->>\"$.abbonamento_selezionato\"\r\n    '),
(4,	'gtt',	'SELECT \r\n      Subscriptions.id, subscription, user_id, company_id, status_id, note, created, modified,        \r\n      Companies.name as nome_azienda, \r\n      Companies.company_code as codice_azienda,\r\n      subscription->\"$.mese_validita\" as mese_validita,\r\n      subscription->\"$.origine\" as origine,\r\n      subscription->\"$.destinazione\" as destinazione,\r\n      subscription->\"$.abbonamento_selezionato\" as abbonamento_selezionato,\r\n      subscription->\"$.nome\" as nome,\r\n      subscription->\"$.cognome\" as cognome,\r\n      subscription->\"$.codice_fiscale\" as codice_fiscale,\r\n      subscription->\"$.cittadinanza\" as cittadinanza,\r\n      subscription->\"$.comune_nascita\" as comune_nascita,\r\n      subscription->\"$.provincia_nascita\" as provincia_nascita,\r\n      subscription->\"$.documento_ID\" as documento_ID,\r\n      subscription->\"$.nr_documento_ID\" as nr_documento_ID,\r\n      subscription->\"$.residenza\" as residenza,\r\n      subscription->\"$.email\" as email,\r\n      subscription->\"$.telefono\" as telefono,\r\n      subscription->\"$.matricola\" as matricola,\r\n      subscription->\"$.tessera_tpl\" as tessera_tpl,\r\n      subscription->\"$.operatore\" as operatore,\r\n      subscription->\"$.prezzo_pieno\" as prezzo_pieno,\r\n      subscription->\"$.prezzo_scontato\" as prezzo_scontato,\r\n      subscription->\"$.sesso\" as sesso,\r\n      subscription->\"$.cap_residenza\" as cap_residenza,\r\n      subscription->\"$.comune_residenza\" as comune_residenza,\r\n      subscription->\"$.provincia_residenza\" as provincia_residenza,\r\n      subscription->\"$.data_nascita\" as data_nascita\r\n    FROM \r\n      subscriptions Subscriptions \r\n      left join companies Companies on (Subscriptions.company_id = Companies.id)\r\n    WHERE \r\n      Subscriptions.status_id =1'),
(5,	'trenord',	'SELECT \r\n      Subscriptions.id, subscription, user_id, company_id, status_id, note, created, modified,        \r\n      Companies.name as nome_azienda, \r\n      Companies.company_code as codice_azienda,\r\n      subscription->\"$.mese_validita\" as mese_validita,\r\n      subscription->\"$.origine\" as origine,\r\n      subscription->\"$.destinazione\" as destinazione,\r\n      subscription->\"$.abbonamento_selezionato\" as abbonamento_selezionato,\r\n      subscription->\"$.nome\" as nome,\r\n      subscription->\"$.cognome\" as cognome,\r\n      subscription->\"$.codice_fiscale\" as codice_fiscale,\r\n      subscription->\"$.cittadinanza\" as cittadinanza,\r\n      subscription->\"$.comune_nascita\" as comune_nascita,\r\n      subscription->\"$.provincia_nascita\" as provincia_nascita,\r\n      subscription->\"$.documento_ID\" as documento_ID,\r\n      subscription->\"$.nr_documento_ID\" as nr_documento_ID,\r\n      subscription->\"$.residenza\" as residenza,\r\n      subscription->\"$.email\" as email,\r\n      subscription->\"$.telefono\" as telefono,\r\n      subscription->\"$.matricola\" as matricola,\r\n      subscription->\"$.tessera_tpl\" as tessera_tpl,\r\n      subscription->\"$.operatore\" as operatore,\r\n      subscription->\"$.prezzo_pieno\" as prezzo_pieno,\r\n      subscription->\"$.prezzo_scontato\" as prezzo_scontato,\r\n      subscription->\"$.sesso\" as sesso,\r\n      subscription->\"$.cap_residenza\" as cap_residenza,\r\n      subscription->\"$.comune_residenza\" as comune_residenza,\r\n      subscription->\"$.provincia_residenza\" as provincia_residenza,\r\n      subscription->\"$.data_nascita\" as data_nascita\r\n    FROM \r\n      subscriptions Subscriptions \r\n      left join companies Companies on (Subscriptions.company_id = Companies.id)\r\n    WHERE \r\n      Subscriptions.status_id =1'),
(6,	'atac',	'SELECT \r\n      Subscriptions.id, subscription, user_id, company_id, status_id, note, created, modified,        \r\n      Companies.name as nome_azienda, \r\n      Companies.company_code as codice_azienda,\r\n      subscription->\"$.mese_validita\" as mese_validita,\r\n      subscription->\"$.origine\" as origine,\r\n      subscription->\"$.destinazione\" as destinazione,\r\n      subscription->\"$.abbonamento_selezionato\" as abbonamento_selezionato,\r\n      subscription->\"$.nome\" as nome,\r\n      subscription->\"$.cognome\" as cognome,\r\n      subscription->\"$.codice_fiscale\" as codice_fiscale,\r\n      subscription->\"$.cittadinanza\" as cittadinanza,\r\n      subscription->\"$.comune_nascita\" as comune_nascita,\r\n      subscription->\"$.provincia_nascita\" as provincia_nascita,\r\n      subscription->\"$.documento_ID\" as documento_ID,\r\n      subscription->\"$.nr_documento_ID\" as nr_documento_ID,\r\n      subscription->\"$.residenza\" as residenza,\r\n      subscription->\"$.email\" as email,\r\n      subscription->\"$.telefono\" as telefono,\r\n      subscription->\"$.matricola\" as matricola,\r\n      subscription->\"$.tessera_tpl\" as tessera_tpl,\r\n      subscription->\"$.operatore\" as operatore,\r\n      subscription->\"$.prezzo_pieno\" as prezzo_pieno,\r\n      subscription->\"$.prezzo_scontato\" as prezzo_scontato,\r\n      subscription->\"$.sesso\" as sesso,\r\n      subscription->\"$.cap_residenza\" as cap_residenza,\r\n      subscription->\"$.comune_residenza\" as comune_residenza,\r\n      subscription->\"$.provincia_residenza\" as provincia_residenza,\r\n      subscription->\"$.data_nascita\" as data_nascita\r\n    FROM \r\n      subscriptions Subscriptions \r\n      left join companies Companies on (Subscriptions.company_id = Companies.id)\r\n    WHERE \r\n      Subscriptions.status_id =1'),
(7,	'sisal',	'SELECT \r\n      Subscriptions.id, subscription, user_id, company_id, status_id, note, created, modified,        \r\n      Companies.name as nome_azienda, \r\n      Companies.company_code as codice_azienda,\r\n      subscription->\"$.mese_validita\" as mese_validita,\r\n      subscription->\"$.origine\" as origine,\r\n      subscription->\"$.destinazione\" as destinazione,\r\n      subscription->\"$.abbonamento_selezionato\" as abbonamento_selezionato,\r\n      subscription->\"$.nome\" as nome,\r\n      subscription->\"$.cognome\" as cognome,\r\n      subscription->\"$.codice_fiscale\" as codice_fiscale,\r\n      subscription->\"$.cittadinanza\" as cittadinanza,\r\n      subscription->\"$.comune_nascita\" as comune_nascita,\r\n      subscription->\"$.provincia_nascita\" as provincia_nascita,\r\n      subscription->\"$.documento_ID\" as documento_ID,\r\n      subscription->\"$.nr_documento_ID\" as nr_documento_ID,\r\n      subscription->\"$.residenza\" as residenza,\r\n      subscription->\"$.email\" as email,\r\n      subscription->\"$.telefono\" as telefono,\r\n      subscription->\"$.matricola\" as matricola,\r\n      subscription->\"$.tessera_tpl\" as tessera_tpl,\r\n      subscription->\"$.operatore\" as operatore,\r\n      subscription->\"$.prezzo_pieno\" as prezzo_pieno,\r\n      subscription->\"$.prezzo_scontato\" as prezzo_scontato,\r\n      subscription->\"$.sesso\" as sesso,\r\n      subscription->\"$.cap_residenza\" as cap_residenza,\r\n      subscription->\"$.comune_residenza\" as comune_residenza,\r\n      subscription->\"$.provincia_residenza\" as provincia_residenza,\r\n      subscription->\"$.data_nascita\" as data_nascita\r\n    FROM \r\n      subscriptions Subscriptions \r\n      left join companies Companies on (Subscriptions.company_id = Companies.id)\r\n    WHERE \r\n      Subscriptions.status_id =1'),
(8,	'sisalpay',	'SELECT \r\n      Subscriptions.id, subscription, user_id, company_id, status_id, note, created, modified,        \r\n      Companies.name as nome_azienda, \r\n      Companies.company_code as codice_azienda,\r\n      subscription->\"$.mese_validita\" as mese_validita,\r\n      subscription->\"$.origine\" as origine,\r\n      subscription->\"$.destinazione\" as destinazione,\r\n      subscription->\"$.abbonamento_selezionato\" as abbonamento_selezionato,\r\n      subscription->\"$.nome\" as nome,\r\n      subscription->\"$.cognome\" as cognome,\r\n      subscription->\"$.codice_fiscale\" as codice_fiscale,\r\n      subscription->\"$.cittadinanza\" as cittadinanza,\r\n      subscription->\"$.comune_nascita\" as comune_nascita,\r\n      subscription->\"$.provincia_nascita\" as provincia_nascita,\r\n      subscription->\"$.documento_ID\" as documento_ID,\r\n      subscription->\"$.nr_documento_ID\" as nr_documento_ID,\r\n      subscription->\"$.residenza\" as residenza,\r\n      subscription->\"$.email\" as email,\r\n      subscription->\"$.telefono\" as telefono,\r\n      subscription->\"$.matricola\" as matricola,\r\n      subscription->\"$.tessera_tpl\" as tessera_tpl,\r\n      subscription->\"$.operatore\" as operatore,\r\n      subscription->\"$.prezzo_pieno\" as prezzo_pieno,\r\n      subscription->\"$.prezzo_scontato\" as prezzo_scontato,\r\n      subscription->\"$.sesso\" as sesso,\r\n      subscription->\"$.cap_residenza\" as cap_residenza,\r\n      subscription->\"$.comune_residenza\" as comune_residenza,\r\n      subscription->\"$.provincia_residenza\" as provincia_residenza,\r\n      subscription->\"$.data_nascita\" as data_nascita\r\n    FROM \r\n      subscriptions Subscriptions \r\n      left join companies Companies on (Subscriptions.company_id = Companies.id)\r\n    WHERE \r\n      Subscriptions.status_id =1'),
(9,	'azimut',	'SELECT \r\n      Subscriptions.id, subscription, user_id, company_id, status_id, note, created, modified,        \r\n      Companies.name as nome_azienda, \r\n      Companies.company_code as codice_azienda,\r\n      subscription->\"$.mese_validita\" as mese_validita,\r\n      subscription->\"$.origine\" as origine,\r\n      subscription->\"$.destinazione\" as destinazione,\r\n      subscription->\"$.abbonamento_selezionato\" as abbonamento_selezionato,\r\n      subscription->\"$.nome\" as nome,\r\n      subscription->\"$.cognome\" as cognome,\r\n      subscription->\"$.codice_fiscale\" as codice_fiscale,\r\n      subscription->\"$.cittadinanza\" as cittadinanza,\r\n      subscription->\"$.comune_nascita\" as comune_nascita,\r\n      subscription->\"$.provincia_nascita\" as provincia_nascita,\r\n      subscription->\"$.documento_ID\" as documento_ID,\r\n      subscription->\"$.nr_documento_ID\" as nr_documento_ID,\r\n      subscription->\"$.residenza\" as residenza,\r\n      subscription->\"$.email\" as email,\r\n      subscription->\"$.telefono\" as telefono,\r\n      subscription->\"$.matricola\" as matricola,\r\n      subscription->\"$.tessera_tpl\" as tessera_tpl,\r\n      subscription->\"$.operatore\" as operatore,\r\n      subscription->\"$.prezzo_pieno\" as prezzo_pieno,\r\n      subscription->\"$.prezzo_scontato\" as prezzo_scontato,\r\n      subscription->\"$.sesso\" as sesso,\r\n      subscription->\"$.cap_residenza\" as cap_residenza,\r\n      subscription->\"$.comune_residenza\" as comune_residenza,\r\n      subscription->\"$.provincia_residenza\" as provincia_residenza,\r\n      subscription->\"$.data_nascita\" as data_nascita\r\n    FROM \r\n      subscriptions Subscriptions \r\n      left join companies Companies on (Subscriptions.company_id = Companies.id)\r\n    WHERE \r\n      Subscriptions.status_id =1'),
(10,	'jointly',	'SELECT \r\n      Subscriptions.id, subscription, user_id, company_id, status_id, note, created, modified,        \r\n      Companies.name as nome_azienda, \r\n      Companies.company_code as codice_azienda,\r\n      subscription->\"$.mese_validita\" as mese_validita,\r\n      subscription->\"$.origine\" as origine,\r\n      subscription->\"$.destinazione\" as destinazione,\r\n      subscription->\"$.abbonamento_selezionato\" as abbonamento_selezionato,\r\n      subscription->\"$.nome\" as nome,\r\n      subscription->\"$.cognome\" as cognome,\r\n      subscription->\"$.codice_fiscale\" as codice_fiscale,\r\n      subscription->\"$.cittadinanza\" as cittadinanza,\r\n      subscription->\"$.comune_nascita\" as comune_nascita,\r\n      subscription->\"$.provincia_nascita\" as provincia_nascita,\r\n      subscription->\"$.documento_ID\" as documento_ID,\r\n      subscription->\"$.nr_documento_ID\" as nr_documento_ID,\r\n      subscription->\"$.residenza\" as residenza,\r\n      subscription->\"$.email\" as email,\r\n      subscription->\"$.telefono\" as telefono,\r\n      subscription->\"$.matricola\" as matricola,\r\n      subscription->\"$.tessera_tpl\" as tessera_tpl,\r\n      subscription->\"$.operatore\" as operatore,\r\n      subscription->\"$.prezzo_pieno\" as prezzo_pieno,\r\n      subscription->\"$.prezzo_scontato\" as prezzo_scontato,\r\n      subscription->\"$.sesso\" as sesso,\r\n      subscription->\"$.cap_residenza\" as cap_residenza,\r\n      subscription->\"$.comune_residenza\" as comune_residenza,\r\n      subscription->\"$.provincia_residenza\" as provincia_residenza,\r\n      subscription->\"$.data_nascita\" as data_nascita\r\n    FROM \r\n      subscriptions Subscriptions \r\n      left join companies Companies on (Subscriptions.company_id = Companies.id)\r\n    WHERE \r\n      Subscriptions.status_id =1'),
(11,	'all',	'SELECT \r\n      Subscriptions.id, subscription, user_id, company_id, status_id, note, created, modified,        \r\n      Companies.name as nome_azienda, \r\n      Companies.company_code as codice_azienda,\r\n      subscription->\"$.mese_validita\" as mese_validita,\r\n      subscription->\"$.origine\" as origine,\r\n      subscription->\"$.destinazione\" as destinazione,\r\n      subscription->\"$.abbonamento_selezionato\" as abbonamento_selezionato,\r\n      subscription->\"$.nome\" as nome,\r\n      subscription->\"$.cognome\" as cognome,\r\n      subscription->\"$.codice_fiscale\" as codice_fiscale,\r\n      subscription->\"$.cittadinanza\" as cittadinanza,\r\n      subscription->\"$.comune_nascita\" as comune_nascita,\r\n      subscription->\"$.provincia_nascita\" as provincia_nascita,\r\n      subscription->\"$.documento_ID\" as documento_ID,\r\n      subscription->\"$.nr_documento_ID\" as nr_documento_ID,\r\n      subscription->\"$.residenza\" as residenza,\r\n      subscription->\"$.email\" as email,\r\n      subscription->\"$.telefono\" as telefono,\r\n      subscription->\"$.matricola\" as matricola,\r\n      subscription->\"$.tessera_tpl\" as tessera_tpl,\r\n      subscription->\"$.operatore\" as operatore,\r\n      subscription->\"$.prezzo_pieno\" as prezzo_pieno,\r\n      subscription->\"$.prezzo_scontato\" as prezzo_scontato,\r\n      subscription->\"$.sesso\" as sesso,\r\n      subscription->\"$.cap_residenza\" as cap_residenza,\r\n      subscription->\"$.comune_residenza\" as comune_residenza,\r\n      subscription->\"$.provincia_residenza\" as provincia_residenza,\r\n      subscription->\"$.data_nascita\" as data_nascita\r\n    FROM \r\n      subscriptions Subscriptions \r\n      left join companies Companies on (Subscriptions.company_id = Companies.id)\r\n    WHERE \r\n      Subscriptions.status_id =1');

-- 2021-01-26 07:53:47
